Version 1
SubGoalCombiner SGC_AND
INITSECTION
LLDT_Menu_BuildSettings();
//LLDT_Menu_Add_Point(_Player, "Attribute");
//LLDT_Menu_Add_Point(_Player, "Ability");
//LLDT_Menu_Add_Point(_Player, "Civil");
//LLDT_Menu_Add_Point(_Player, "Talent");
//LLDT_Menu_Add_Point(_Player, "Source");
//LLDT_Menu_Add_Point(_Player, "SourceMax");
KBSECTION
//REGION RESET
PROC
LLDT_Menu_ResetCommands((CHARACTERGUID)_Player)
AND
DB_LLDT_CommandFlags(_Flag)
THEN
ObjectClearFlag(_Player, _Flag);

/*
PROC
LLDT_Menu_ResetPartyCommands((CHARACTERGUID)_Player, (INTEGER)_Instance)
AND
DB_LLDT_PartyCommandFlags(_Flag)
THEN
PartyClearFlag(_Player, _Flag, _Instance);
*/
//END_REGION

//REGION BUILD_SETTINGS
PROC
LLDT_Menu_BuildSettings()
THEN
SysClear("DB_LLDT_Skills_All", 1);
DB_LLDT_Skills_All("Shout_LLDT_OpenMenu");
DB_LLDT_Skills_All("Target_LLDT_GenerateTradeTreasure");
DB_LLDT_Skills_All("Target_LLDT_ClearTradeTreasure");
DB_LLDT_Skills_All("Target_LLDT_ClearItems");
DB_LLDT_Skills_All("Target_LLDT_GenGold");
DB_LLDT_Skills_All("Target_LLDT_LevelUp");
DB_LLDT_Skills_All("Shout_LLDT_LevelUpParty");
DB_LLDT_Skills_All("Target_LLDT_TeleportSelf");
DB_LLDT_Skills_All("Target_LLDT_TeleportParty");
DB_LLDT_Skills_All("Teleportation_LLDT_TeleportTarget");

SysClear("DB_LLDT_Skills_Essentials", 1);
DB_LLDT_Skills_Essentials("Shout_LLDT_OpenMenu");
DB_LLDT_Skills_Essentials("Target_LLDT_GenGold");
DB_LLDT_Skills_Essentials("Target_LLDT_LevelUp");
DB_LLDT_Skills_Essentials("Shout_LLDT_LevelUpParty");
DB_LLDT_Skills_Essentials("Target_LLDT_TeleportSelf");
DB_LLDT_Skills_Essentials("Target_LLDT_TeleportParty");
DB_LLDT_Skills_Essentials("Teleportation_LLDT_TeleportTarget");

SysClear("DB_LLDT_Skills_Treasure", 1);
DB_LLDT_Skills_Treasure("Shout_LLDT_OpenMenu");
DB_LLDT_Skills_Treasure("Target_LLDT_GenerateTradeTreasure");
DB_LLDT_Skills_Treasure("Target_LLDT_ClearTradeTreasure");
DB_LLDT_Skills_Treasure("Target_LLDT_ClearItems");
DB_LLDT_Skills_Treasure("Target_LLDT_GenGold");

SysClear("DB_LLDT_CommandFlags", 1);
DB_LLDT_CommandFlags("LLDT_ADD_ATTRIBUTE");
DB_LLDT_CommandFlags("LLDT_ADD_ABILITY");
DB_LLDT_CommandFlags("LLDT_ADD_CIVIL");
DB_LLDT_CommandFlags("LLDT_ADD_TALENT");
DB_LLDT_CommandFlags("LLDT_ADD_SOURCE");
DB_LLDT_CommandFlags("LLDT_ADD_ALL");
DB_LLDT_CommandFlags("LLDT_ADD_ATTRIBUTE_PARTY");
DB_LLDT_CommandFlags("LLDT_ADD_ABILITY_PARTY");
DB_LLDT_CommandFlags("LLDT_ADD_CIVIL_PARTY");
DB_LLDT_CommandFlags("LLDT_ADD_TALENT_PARTY");
DB_LLDT_CommandFlags("LLDT_ADD_SOURCE_PARTY");
DB_LLDT_CommandFlags("LLDT_ADD_ALL_PARTY");
DB_LLDT_CommandFlags("LLDT_ADD_SKILLS_MENU");
DB_LLDT_CommandFlags("LLDT_ADD_SKILLS_ESSENTIALS");
DB_LLDT_CommandFlags("LLDT_ADD_SKILLS_TREASURE");
DB_LLDT_CommandFlags("LLDT_ADD_SKILLS");
DB_LLDT_CommandFlags("LLDT_ADD_SKILLS_PARTY");
DB_LLDT_CommandFlags("LLDT_REMOVE_SKILLS");
DB_LLDT_CommandFlags("LLDT_REMOVE_SKILLS_PARTY");
DB_LLDT_CommandFlags("LLDT_REMOVE_COLLAR_PARTY");
DB_LLDT_CommandFlags("LLDT_RESURRECT_PARTY");
DB_LLDT_CommandFlags("LLDT_FULLHEAL_PARTY");
//END_REGION

//REGION POINTS
PROC
LLDT_Menu_Add_Point((CHARACTERGUID)_Player, "Attribute")
AND
CharacterGetAttributePoints(_Player, _CurrentPoints)
AND
IntegerSum(_CurrentPoints, 1, _Points)
AND
IntegertoString(_Points, _PointsStr)
THEN
CharacterAddAttributePoint(_Player, 1);
LLDT_Print(_Player, "<font color='#F5DA81'> +1 Attribute Point</font> (<font color='#00FF00'>", _PointsStr, "</font>)</font>");

PROC
LLDT_Menu_Add_Point((CHARACTERGUID)_Player, "Ability")
AND
CharacterGetAbilityPoints(_Player, _CurrentPoints)
AND
IntegerSum(_CurrentPoints, 1, _Points)
AND
IntegertoString(_Points, _PointsStr)
THEN
CharacterAddAbilityPoint(_Player, 1);
LLDT_Print(_Player, "<font color='#F6CED8'> +1 Ability Point</font> (<font color='#00FF00'>", _PointsStr, "</font>)</font>");

PROC
LLDT_Menu_Add_Point((CHARACTERGUID)_Player, "Civil")
AND
CharacterGetCivilAbilityPoints(_Player, _CurrentPoints)
AND
IntegerSum(_CurrentPoints, 1, _Points)
AND
IntegertoString(_Points, _PointsStr)
THEN
CharacterAddCivilAbilityPoint(_Player, 1);
LLDT_Print(_Player, "<font color='#DA81F5'> +1 Civil Point (<font color='#00FF00'>", _PointsStr, "</font>)</font>");

PROC
LLDT_Menu_Add_Point((CHARACTERGUID)_Player, "Talent")
AND
CharacterGetTalentPoints(_Player, _CurrentPoints)
AND
IntegerSum(_CurrentPoints, 1, _Points)
AND
IntegertoString(_Points, _PointsStr)
THEN
CharacterAddTalentPoint(_Player, 1);
LLDT_Print(_Player, "<font color='#F5D0A9'> +1 Talent Point (<font color='#00FF00'>", _PointsStr, "</font>)</font>");

PROC
LLDT_Menu_Add_Point((CHARACTERGUID)_Player, "All")
THEN
CharacterAddAttributePoint(_Player, 1);
CharacterAddAbilityPoint(_Player, 1);
CharacterAddCivilAbilityPoint(_Player, 1);
CharacterAddTalentPoint(_Player, 1);
LLDT_Print(_Player, "<font color='#D8F6CE'>+1 Attribute, Ability, Civil, and Talent Points</font>");

PROC
LLDT_Menu_Add_Point((CHARACTERGUID)_Player, "Source")
AND
CharacterGetSourcePoints(_Player, _CurrentPoints)
AND
IntegerSum(_CurrentPoints, 1, _Points)
AND
IntegertoString(_Points, _PointsStr)
THEN
CharacterAddSourcePoints(_Player, 1);
LLDT_Print(_Player, "<font color='#81F7F3'> +1 Source Point (<font color='#00FF00'>", _PointsStr, "</font>)</font>");
PlayEffect(_Player, "RS3_FX_GP_ScriptedEvent_Source_Absorb_01");

PROC
LLDT_Menu_Add_Point((CHARACTERGUID)_Player, "SourceMax")
AND
CharacterGetMaxSourcePoints(_Player, _Max)
AND
IntegerSum(_Max, 1, _NewMax)
AND
IntegertoString(_NewMax, _NewMaxStr)
THEN
CharacterOverrideMaxSourcePoints(_Player, _NewMax);
LLDT_Print(_Player, "<font color='#BE81F7'> +1 Max Source Points (<font color='#00FF00'>", _NewMaxStr, "</font>)</font>");

IF
ObjectFlagSet("LLDT_ADD_ATTRIBUTE", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_ATTRIBUTE")
THEN
LLDT_Menu_Add_Point(_Player, "Attribute");

IF
ObjectFlagSet("LLDT_ADD_ABILITY", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_ABILITY")
THEN
LLDT_Menu_Add_Point(_Player, "Ability");

IF
ObjectFlagSet("LLDT_ADD_CIVIL", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_CIVIL")
THEN
LLDT_Menu_Add_Point(_Player, "Civil");

IF
ObjectFlagSet("LLDT_ADD_TALENT", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_TALENT")
THEN
LLDT_Menu_Add_Point(_Player, "Talent");

IF
ObjectFlagSet("LLDT_ADD_ALL", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_ALL")
THEN
LLDT_Menu_Add_Point(_Player, "All");

IF
ObjectFlagSet("LLDT_ADD_SOURCE", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_SOURCE")
THEN
LLDT_Menu_Add_Point(_Player, "Source");

IF
ObjectFlagSet("LLDT_ADD_SOURCE_MAX", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_SOURCE_MAX")
THEN
LLDT_Menu_Add_Point(_Player, "SourceMax");

IF
ObjectFlagSet("LLDT_REMOVE_SOURCE_MAX", (CHARACTERGUID)_Player, _Instance)
AND
CharacterGetMaxSourcePoints(_Player, _Max)
AND
IntegerSubtract(_Max, 1, _NewMax)
AND
_NewMax >= 0
AND
IntegertoString(_NewMax, _MaxStr)
THEN
CharacterOverrideMaxSourcePoints(_Player, _NewMax);
LLDT_Print(_Player, "<font color='#FE2E2E'>-1 Max Source Points (<font color='#00FF00'>", _MaxStr, "</font>)</font>");
ObjectClearFlag(_Player, "LLDT_REMOVE_SOURCE_MAX");

IF
ObjectFlagSet("LLDT_ADD_ATTRIBUTE_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_ATTRIBUTE_PARTY")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_Add_Point(_Player, "Attribute");

IF
ObjectFlagSet("LLDT_ADD_ABILITY_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_ABILITY_PARTY")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_Add_Point(_Player, "Ability");

IF
ObjectFlagSet("LLDT_ADD_CIVIL_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_CIVIL_PARTY")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_Add_Point(_Player, "Civil");

IF
ObjectFlagSet("LLDT_ADD_TALENT_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_TALENT_PARTY")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_Add_Point(_Player, "Talent");

IF
ObjectFlagSet("LLDT_ADD_ALL_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_ALL_PARTY")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_Add_Point(_Player, "All");

IF
ObjectFlagSet("LLDT_ADD_SOURCE_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_SOURCE_PARTY")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_Add_Point(_Player, "Source");

IF
ObjectFlagSet("LLDT_ADD_SOURCE_MAX_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_SOURCE_MAX_PARTY")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_Add_Point(_Player, "SourceMax");

IF
ObjectFlagSet("LLDT_REMOVE_SOURCE_MAX_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_REMOVE_SOURCE_MAX_PARTY")
AND
DB_IsPlayer(_Player)
AND
CharacterGetMaxSourcePoints(_Player, _Max)
AND
IntegerSubtract(_Max, 1, _NewMax)
AND
_NewMax >= 0
AND
IntegertoString(_NewMax, _MaxStr)
THEN
CharacterOverrideMaxSourcePoints(_Player, _NewMax);
LLDT_Print(_Player, "<font color='#FE2E2E'>-1 Max Source Points (<font color='#00FF00'>", _MaxStr, "</font>)</font>");
//END_REGION

//REGION DISPLAY_FLAGS
IF
ObjectFlagSet(_Flag, (CHARACTERGUID)_Player, _Instance)
AND
ObjectGetFlag(_Player, "LLDT_LOG_DISPLAYFLAGS", 1)
AND
ObjectGetFlag(_Player, _Flag, _Val)
THEN
LLDT_LogFlag(_Player, _Flag, _Val);

IF
ObjectFlagCleared(_Flag, (CHARACTERGUID)_Player, _Instance)
AND
ObjectGetFlag(_Player, "LLDT_LOG_DISPLAYFLAGS", 1)
AND
ObjectGetFlag(_Player, _Flag, _Val)
THEN
LLDT_LogFlag(_Player, _Flag, _Val);

IF
ObjectFlagSet(_Flag, (CHARACTERGUID)_Player, _Instance)
AND
ObjectGetFlag(_Player, "LLDT_LOG_PRINTFLAGS", 1)
AND
ObjectGetFlag(_Player, _Flag, _Val)
THEN
LLDT_PrintFlag(_Player, _Flag, _Val);

IF
ObjectFlagCleared(_Flag, (CHARACTERGUID)_Player, _Instance)
AND
ObjectGetFlag(_Player, "LLDT_LOG_PRINTFLAGS", 1)
AND
ObjectGetFlag(_Player, _Flag, _Val)
THEN
LLDT_PrintFlag(_Player, _Flag, _Val);
//END_REGION

//REGION LOG_SETTINGS
IF
ObjectFlagSet("LLDT_LOG_ENABLED", (CHARACTERGUID)_Player, _Instance)
THEN
SetVarFixedString(_Player, "LLDebugTools_LogText", "Log Enabled");
SetStoryEvent(_Player, "LLDT_Event_PlayerDebugLog");
//END_REGION

//REGION SKILLS
IF
ObjectFlagSet("LLDT_ADD_SKILLS_MENU", (CHARACTERGUID)_Player, _Instance)
AND
CharacterHasSkill(_Player, "Shout_LLDT_OpenMenu", 0)
THEN
CharacterAddSkill(_Player, "Shout_LLDT_OpenMenu");
ObjectClearFlag(_Player, "LLDT_ADD_SKILLS_MENU");
LLDT_Print(_Player, "[DT] Added skill Shout_LLDT_OpenMenu");

IF
ObjectFlagSet("LLDT_ADD_SKILLS_ESSENTIALS", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_SKILLS_ESSENTIALS")
AND
DB_LLDT_Skills_Essentials(_Skill)
AND
CharacterHasSkill(_Player, _Skill, 0)
THEN
CharacterAddSkill(_Player, _Skill);
LLDT_Print(_Player, "[DT] Added skill ", _Skill);

IF
ObjectFlagSet("LLDT_ADD_SKILLS_TREASURE", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_SKILLS_TREASURE")
AND
DB_LLDT_Skills_Treasure(_Skill)
AND
CharacterHasSkill(_Player, _Skill, 0)
THEN
CharacterAddSkill(_Player, _Skill);
LLDT_Print(_Player, "[DT] Added skill ", _Skill);

IF
ObjectFlagSet("LLDT_ADD_SKILLS", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_ADD_SKILLS")
AND
DB_LLDT_Skills_All(_Skill)
AND
CharacterHasSkill(_Player, _Skill, 0)
THEN
CharacterAddSkill(_Player, _Skill);
LLDT_Print(_Player, "[DT] Added skill ", _Skill);

IF
ObjectFlagSet("LLDT_ADD_SKILLS_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_SKILLS_PARTY")
AND
DB_IsPlayer(_Player)
AND
DB_LLDT_Skills_All(_Skill)
AND
CharacterHasSkill(_Player, _Skill, 0)
THEN
CharacterAddSkill(_Player, _Skill);
LLDT_Print(_Player, "[DT] Added skill ", _Skill);

IF
ObjectFlagSet("LLDT_REMOVE_SKILLS", (CHARACTERGUID)_Player, _Instance)
AND
LLDT_QRY_ClearFlag(_Player, "LLDT_REMOVE_SKILLS")
AND
DB_LLDT_Skills_All(_Skill)
AND
CharacterHasSkill(_Player, _Skill, 1)
THEN
CharacterRemoveSkill(_Player, _Skill);
LLDT_Print(_Player, "[DT] Removed skill ", _Skill);

IF
ObjectFlagSet("LLDT_REMOVE_SKILLS_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearPartyFlag(_Speaker, "LLDT_REMOVE_SKILLS_PARTY", _Instance)
AND
DB_IsPlayer(_Player)
AND
DB_LLDT_Skills_All(_Skill)
AND
CharacterHasSkill(_Player, _Skill, 1)
THEN
CharacterRemoveSkill(_Player, _Skill);
LLDT_Print(_Player, "[DT] Removed skill ", _Skill);

//END_REGION

//REGION WAYPOINTS
PROC
LLDT_Menu_UnlockAllWaypoints((CHARACTERGUID)_Player)
AND
DB_WaypointInfo(_Item,_Trigger,_CurrentWP)
THEN
ProcDoWaypointUnlock(_Item, _Player);

PROC
LLDT_Menu_UnlockAllWaypoints((CHARACTERGUID)_Player)
THEN
//2: the button is visible, enabled, and flashes to indicate a new waypoint is available
SetHomesteadKeyState(2, _Player);

IF
ObjectFlagSet("LLDT_ADD_WAYPOINTS", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_ADD_WAYPOINTS")
AND
LLDT_QRY_Print(_Speaker, "All waypoints unlocked")
AND
DB_IsPlayer(_Player)
THEN
LLDT_Menu_UnlockAllWaypoints(_Player);

//END_REGION

//REGION IMMORTALITY
IF
ObjectFlagSet("LLDT_IMMORTALITY_ENABLED", (CHARACTERGUID)_Player, _Instance)
THEN
LLDT_Helpers_SetTag(_Player, "DEATHFOG_IMMUNE");
LLDT_Helpers_SetTag(_Player, "CHICKENTOUCH_IMMUNE");
CharacterSetImmortal(_Player, 1);
ProcSetInvulnerable(_Player, 1);
DisplayText(_Player, "<font color='#A52A2A' size='30'>There can only be ONE!</font>");
PlayAnimation(_Player, "", "");
PlayAnimation(_Player, "skill_cast_shout_01_cast", "");

IF
ObjectFlagCleared("LLDT_IMMORTALITY_ENABLED", (CHARACTERGUID)_Player, _Instance)
THEN
LLDT_Helpers_ResetTag(_Player, "DEATHFOG_IMMUNE");
LLDT_Helpers_ResetTag(_Player, "CHICKENTOUCH_IMMUNE");
CharacterSetImmortal(_Player, 0);
ProcSetInvulnerable(_Player, 0);
DisplayText(_Player, "<font size='26'>I'm... <font color='#FFFF00' size='13'>mortal</font>...</font>");
PlayAnimation(_Player, "", "");
PlayAnimation(_Player, "emotion_sad", "");

//END_REGION

//REGION QUICK_COMMANDS
IF
ObjectFlagSet("LLDT_REMOVE_COLLAR_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_REMOVE_COLLAR_PARTY")
AND
DB_IsPlayer(_Player)
THEN
ObjectSetFlag(_Player, "FTJ_RemoveSourceCollar");

IF
ObjectFlagSet("LLDT_RESURRECT_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_RESURRECT_PARTY")
AND
DB_IsPlayer(_Player)
AND
CharacterIsDead(_Player, 1)
THEN
CharacterResurrect(_Player);
CharacterSetHitpointsPercentage(_Player, 100);

IF
ObjectFlagSet("LLDT_FULLHEAL_PARTY", (CHARACTERGUID)_Speaker, _Instance)
AND
LLDT_QRY_ClearFlag(_Speaker, "LLDT_FULLHEAL_PARTY")
AND
DB_IsPlayer(_Player)
THEN
CharacterSetHitpointsPercentage(_Player, 100);

//END_REGION

//REGION MOD_UPDATE
PROC
LLDT_System_UpdateAll()
THEN
LLDT_Menu_BuildSettings();
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ZZZ_LL_DebugTools"
